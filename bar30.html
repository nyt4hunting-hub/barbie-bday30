<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Happy 19th, Barbie üéâ</title>
<style>
  :root{
    --bg1:#ff9a9e; --bg2:#fad0c4;
    --card: rgba(255,255,255,0.9);
    --accent:#6a11cb;
  }
  html,body{height:100%;margin:0;font-family:Inter, system-ui, Arial, sans-serif}
  body{
    background: linear-gradient(135deg,var(--bg1),var(--bg2));
    display:flex;align-items:center;justify-content:center;
    padding:20px;
    -webkit-font-smoothing:antialiased;
  }
  .app{
    width:100%;max-width:940px;background:linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.06));
    border-radius:18px;box-shadow:0 10px 40px rgba(10,10,30,0.15);overflow:hidden;
    backdrop-filter: blur(6px);
  }
  header{
    padding:18px 22px;display:flex;align-items:center;gap:12px;
  }
  header h1{margin:0;font-size:20px;color:white;text-shadow:0 2px 8px rgba(0,0,0,0.3)}
  .main{display:flex;gap:0}
  .panel{
    flex:1;padding:28px;min-height:480px;position:relative;color:#1b1b1b;
  }
  .card{
    background:var(--card);border-radius:12px;padding:20px;box-shadow:0 6px 20px rgba(20,20,40,0.08);
  }
  .center{display:flex;flex-direction:column;align-items:center;gap:14px;justify-content:center}
  .btn{background:linear-gradient(90deg,var(--accent), #2575fc);color:white;padding:10px 16px;border-radius:10px;border:none;font-weight:600;cursor:pointer}
  .small{padding:8px 12px;border-radius:8px;font-size:14px}
  .controls{display:flex;gap:10px;align-items:center}
  .pager{display:flex;gap:8px;align-items:center;margin-top:14px}
  .question{font-size:18px;margin-bottom:12px}
  .options{display:flex;flex-direction:column;gap:8px}
  input[type="text"]{padding:10px;border-radius:10px;border:1px solid rgba(0,0,0,0.08);width:100%}
  .progress{height:8px;background:rgba(0,0,0,0.06);border-radius:8px;overflow:hidden;margin-top:12px}
  .progress > i{display:block;height:100%;background:linear-gradient(90deg,#ffd89b,#19547b);width:0%}
  /* top-right decorations */
  .decors{position:absolute;right:18px;top:18px;pointer-events:none}
  .balloon{position:absolute;width:40px;height:60px;border-radius:20px 20px 20px 20px;transform-origin:center bottom;opacity:0.95}
  /* final cake */
  .cake-wrap{display:flex;flex-direction:column;align-items:center;gap:12px}
  .cake{width:260px;height:160px;background:#fff;border-radius:14px;position:relative;box-shadow:0 8px 30px rgba(0,0,0,0.12)}
  .cake::before{content:"";position:absolute;left:12px;right:12px;top:12px;height:60px;background:linear-gradient(90deg,#ffe0e6,#ffd5c2);border-radius:10px}
  .candle{position:absolute;left:50%;transform:translateX(-50%);top:-40px;display:flex;flex-direction:column;align-items:center;gap:6px}
  .wick{width:6px;height:20px;background:#333;border-radius:3px}
  .flame{width:16px;height:20px;border-radius:50%;background: radial-gradient(circle at 35% 35%, #fff9c4, #ffecb3 20%, #ff9800 60%);filter:drop-shadow(0 3px 6px rgba(255,140,0,0.4))}
  .hidden{display:none}
  footer{padding:12px 20px;display:flex;justify-content:space-between;align-items:center;background:transparent}
  .muted{font-size:13px;color:rgba(255,255,255,0.9)}
  /* responsive */
  @media(max-width:700px){
    .app{border-radius:12px}
    .cake{width:220px;height:140px}
  }
</style>
</head>
<body>
<div class="app" id="app">
  <header>
    <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='40' height='40'><rect rx='8' width='100%' height='100%' fill='%23fff'/><text x='50%' y='55%' font-size='18' font-family='Arial' text-anchor='middle' fill='%236a11cb'>B</text></svg>" style="width:46px;height:46px;border-radius:10px;box-shadow:0 4px 14px rgba(0,0,0,0.12)" alt="">
    <h1>Happy 19th, Barbie üéà</h1>
    <div style="flex:1"></div>
    <div style="color:white;font-weight:600">From: <span id="fromName">Your Bestie</span></div>
  </header>

  <div class="main">
    <div class="panel">
      <div class="card center" id="page0">
        <h2 style="margin:0">Tap to Start the Surprise üéâ</h2>
        <p style="margin:0;color:#222">This is for <strong>Barbie</strong> ‚Äî 19 today! Press start to begin the interactive surprise.</p>
        <div style="height:12px"></div>
        <button class="btn" id="startBtn">Start the Surprise</button>
        <div style="height:10px"></div>
        <div style="font-size:13px;color:#333">Tip: Allow sound on first tap so birthday music & clapping will play.</div>
      </div>

      <!-- Question pages 1..7 -->
      <div class="card hidden" id="page1">
        <div class="question">1) What is my favourite movie (one word)?</div>
        <input type="text" id="a1" placeholder="Type your answer..." autocomplete="off">
        <div class="pager">
          <button class="btn small" onclick="nextPage(2)">Next</button>
        </div>
        <div class="progress"><i id="prog1" style="width:12.5%"></i></div>
      </div>

      <div class="card hidden" id="page2">
        <div class="question">2) Which song makes me dance every time?</div>
        <input type="text" id="a2" placeholder="Type your answer..." autocomplete="off">
        <div class="pager">
          <button class="btn small" onclick="prevPage(1)">Back</button>
          <button class="btn small" onclick="nextPage(3)">Next</button>
        </div>
        <div class="progress"><i style="width:25%"></i></div>
      </div>

      <div class="card hidden" id="page3">
        <div class="question">3) Where did we meet first? (place)</div>
        <input type="text" id="a3" placeholder="Type your answer..." autocomplete="off">
        <div class="pager">
          <button class="btn small" onclick="prevPage(2)">Back</button>
          <button class="btn small" onclick="nextPage(4)">Next</button>
        </div>
        <div class="progress"><i style="width:37.5%"></i></div>
      </div>

      <div class="card hidden" id="page4">
        <div class="question">4) My favourite snack I share with you?</div>
        <input type="text" id="a4" placeholder="Type your answer..." autocomplete="off">
        <div class="pager">
          <button class="btn small" onclick="prevPage(3)">Back</button>
          <button class="btn small" onclick="nextPage(5)">Next</button>
        </div>
        <div class="progress"><i style="width:50%"></i></div>
      </div>

      <div class="card hidden" id="page5">
        <div class="question">5) Pick a day we love the most together:</div>
        <div class="options">
          <button class="btn small opt" onclick="choose('a5','Picnic')">Picnic</button>
          <button class="btn small opt" onclick="choose('a5','Movie Night')">Movie Night</button>
          <button class="btn small opt" onclick="choose('a5','Study Session')">Study Session</button>
        </div>
        <div class="pager">
          <button class="btn small" onclick="prevPage(4)">Back</button>
          <button class="btn small" onclick="nextPage(6)">Next</button>
        </div>
        <div class="progress"><i style="width:62.5%"></i></div>
      </div>

      <div class="card hidden" id="page6">
        <div class="question">6) What nickname do you call me?</div>
        <input type="text" id="a6" placeholder="Type nickname..." autocomplete="off">
        <div class="pager">
          <button class="btn small" onclick="prevPage(5)">Back</button>
          <button class="btn small" onclick="nextPage(7)">Next</button>
        </div>
        <div class="progress"><i style="width:75%"></i></div>
      </div>

      <div class="card hidden" id="page7">
        <div class="question">7) Choose our secret emoji:</div>
        <div class="options">
          <button class="btn small opt" onclick="choose('a7','ü•∞')">ü•∞</button>
          <button class="btn small opt" onclick="choose('a7','üéÄ')">üéÄ</button>
          <button class="btn small opt" onclick="choose('a7','üå∏')">üå∏</button>
        </div>
        <div class="pager">
          <button class="btn small" onclick="prevPage(6)">Back</button>
          <button class="btn small" onclick="nextPage(8)">Next</button>
        </div>
        <div class="progress"><i style="width:87.5%"></i></div>
      </div>

      <!-- final page: cake -->
      <div class="card hidden center" id="page8">
        <h2>All set, Barbie! Time to celebrate üéÇ</h2>
        <div class="cake-wrap" style="margin-top:6px">
          <div class="cake" id="cake">
            <div class="candle" id="candle">
              <div class="flame" id="flame"></div>
              <div class="wick"></div>
            </div>
          </div>
          <div id="finalMsg" style="font-weight:600">Cut the cake when you're ready!</div>
          <div style="display:flex;gap:10px;margin-top:8px">
            <button class="btn small" onclick="cutCake()">Cut the Cake üéÇ</button>
            <button class="btn small" onclick="restart()">Restart</button>
          </div>
        </div>
      </div>

      <!-- decorations layer -->
      <div class="decors" id="decors"></div>
      <canvas id="confettiCanvas" style="position:absolute;left:0;right:0;bottom:0;top:0;pointer-events:none"></canvas>
    </div>
  </div>

  <footer>
    <div class="muted">A small surprise made with love ‚ù§Ô∏è</div>
    <div class="controls">
      <button class="small" id="muteBtn">Mute</button>
      <button class="small" id="downloadBtn">Save as file</button>
    </div>
  </footer>
</div>

<script>
/* ---- Simple UI flow ---- */
const pages = [...Array(9).keys()].slice(0).map(i=>document.getElementById('page'+i));
let current = 0;
function show(i){
  pages.forEach(p=>p && p.classList.add('hidden'));
  if(pages[i]) pages[i].classList.remove('hidden');
  current = i;
  // small progress visual update for header if needed
}
function nextPage(i){
  show(i);
  if(i===8) {
    // show confetti idle
    startConfetti();
  }
}
function prevPage(i){ show(i) }
function choose(id,val){ document.getElementById(id) ? (document.getElementById(id).value = val) : window[id]=val; }

/* start button activates audio (user gesture required on many mobiles) */
const startBtn = document.getElementById('startBtn');
startBtn.onclick = async () => {
  await AudioEngine.start();
  startIntroAnimation();
  show(1);
}

/* cake cut animation + sound */
function cutCake(){
  // extinguish flame
  const flame = document.getElementById('flame');
  flame.style.transition = 'transform 0.5s, opacity 0.6s';
  flame.style.transform = 'scale(0.2) translateY(-6px)';
  flame.style.opacity = 0;
  // big applause and confetti
  AudioEngine.playBigClap();
  burstConfetti(200);
  document.getElementById('finalMsg').textContent = "Happy 19th, Barbie! ü•≥";
}

/* restart */
function restart(){
  location.reload();
}

/* Download as file (save HTML) */
document.getElementById('downloadBtn').addEventListener('click', ()=>{
  const blob = new Blob([document.documentElement.outerHTML], {type:'text/html'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='happy_birthday_barbie.html'; a.click();
  URL.revokeObjectURL(url);
});

/* Mute toggle */
let muted = false;
document.getElementById('muteBtn').onclick = () => {
  muted = !muted;
  AudioEngine.setMuted(muted);
  document.getElementById('muteBtn').textContent = muted ? 'Unmute' : 'Mute';
}

/* ---- Decorations: balloons ---- */
const decors = document.getElementById('decors');
function addBalloon(x,y,color,delay,speed){
  const b = document.createElement('div');
  b.className='balloon';
  b.style.left = x+'px'; b.style.top = y+'px';
  b.style.background = `radial-gradient(circle at 30% 20%, #fff8, ${color})`;
  decors.appendChild(b);
  // float animation
  const dur = (5+Math.random()*6)/speed;
  b.animate([{transform:'translateY(0) rotate(0deg)'},{transform:`translateY(-180px) rotate(${ (Math.random()*40)-20 }deg)`}],
            {duration:dur*1000,delay:delay*1000,iterations:Infinity,direction:'alternate'});
}
function startIntroAnimation(){
  // place a few balloons
  addBalloon(10,8,'#ff6aa6',0.2,1.2);
  addBalloon(60,20,'#ffd166',0.6,1.1);
  addBalloon(110,6,'#a78bfa',0.4,1.4);
  addBalloon(150,22,'#8be9c9',1.0,1.2);
}

/* ---- Confetti (Canvas) ---- */
const confCanvas = document.getElementById('confettiCanvas');
const ctx = confCanvas.getContext('2d');
function resizeCanvas(){ confCanvas.width = confCanvas.clientWidth; confCanvas.height = confCanvas.clientHeight; }
window.addEventListener('resize', resizeCanvas); resizeCanvas();
let confettiPieces = [];
function random(min,max){return Math.random()*(max-min)+min}
function spawnConfetti(n=60){
  for(let i=0;i<n;i++){
    confettiPieces.push({
      x: random(0, confCanvas.width),
      y: random(0, confCanvas.height/2),
      w: random(6,12),
      h: random(8,18),
      vx: random(-1,1),
      vy: random(2,6),
      rot: random(0,Math.PI*2),
      vr: random(-0.1,0.1),
      color: ['#ff6aa6','#ffd166','#a78bfa','#8be9c9','#6a11cb'][Math.floor(random(0,5))],
      ttl: 200 + Math.random()*200
    });
  }
}
function burstConfetti(n=80){
  spawnConfetti(n);
  if(!confettiLooping) startConfetti();
}
let confettiLooping=false;
function startConfetti(){
  confettiLooping = true;
  if(!confettiAnimation) confettiAnimation = requestAnimationFrame(confettiStep);
}
let confettiAnimation = null;
function confettiStep(){
  ctx.clearRect(0,0,confCanvas.width,confCanvas.height);
  for(let i=confettiPieces.length-1;i>=0;i--){
    const p = confettiPieces[i];
    p.x += p.vx;
    p.y += p.vy;
    p.vy += 0.06;
    p.rot += p.vr;
    p.ttl--;
    ctx.save();
    ctx.translate(p.x,p.y);
    ctx.rotate(p.rot);
    ctx.fillStyle = p.color;
    ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
    ctx.restore();
    if(p.y > confCanvas.height + 40 || p.ttl < 0) confettiPieces.splice(i,1);
  }
  if(confettiPieces.length>0) confettiAnimation = requestAnimationFrame(confettiStep);
  else { confettiLooping=false; cancelAnimationFrame(confettiAnimation); confettiAnimation=null }
}

/* ---- AudioEngine: WebAudio synth for melody + claps + crowd ---- */
const AudioEngine = (function(){
  const ctx = new (window.AudioContext || window.webkitAudioContext)();
  let master = ctx.createGain(); master.connect(ctx.destination); master.gain.value = 0.9;
  let muted = false;
  function start(){
    if(ctx.state === 'suspended') return ctx.resume();
    return Promise.resolve();
  }
  function setMuted(m){ muted = m; master.gain.value = m ? 0 : 0.9; }

  /* Play a little "Happy Birthday" melody using oscillator + envelope */
  const melodySeq = [
    // note freq in Hz and duration (s) -> simple Happy Birthday pattern (not perfectly accurate but recognisable)
    [392,0.45],[392,0.35],[440,0.8],[392,0.8],[523.25,0.8],[494,1.0],
    [392,0.45],[392,0.35],[440,0.8],[392,0.8],[587.33,0.8],[523.25,1.0],
    [392,0.45],[392,0.35],[784,0.8],[659.25,0.8],[523.25,0.8],[494,0.8],[440,1.0],
    [698.46,0.45],[698.46,0.35],[659.25,0.8],[523.25,0.8],[587.33,0.8],[523.25,1.4]
  ];
  let melodyLoopInterval = null;
  function playMelody(){
    let t = ctx.currentTime + 0.05;
    for(const [freq,dur] of melodySeq){
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type = 'sine';
      o.frequency.value = freq;
      g.gain.value = 0;
      o.connect(g); g.connect(master);
      o.start(t);
      g.gain.linearRampToValueAtTime(0.18, t+0.02);
      g.gain.linearRampToValueAtTime(0.0, t+dur-0.02);
      o.stop(t+dur+0.05);
      t += dur;
    }
  }
  function startMelodyLoop(){
    playMelody();
    if(melodyLoopInterval) clearInterval(melodyLoopInterval);
    melodyLoopInterval = setInterval(playMelody, 14000); // repeat roughly every 14s
  }
  function stopMelody(){ if(melodyLoopInterval) clearInterval(melodyLoopInterval); melodyLoopInterval=null; }

  /* Clap generator: quick noise bursts */
  function playClap(vol=0.6){
    const length = 0.15;
    const bufferSize = ctx.sampleRate * length;
    const b = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
    const data = b.getChannelData(0);
    for (let i=0;i<bufferSize;i++){
      data[i] = (Math.random()*2-1) * Math.exp(-i / (bufferSize*0.6)); // decaying noise
    }
    const src = ctx.createBufferSource();
    src.buffer = b;
    const g = ctx.createGain(); g.gain.value = vol;
    src.connect(g); g.connect(master);
    src.start();
  }

  /* Crowd clapping: periodic small claps */
  let crowdInterval = null;
  function startCrowd(){
    if(crowdInterval) clearInterval(crowdInterval);
    crowdInterval = setInterval(()=> {
      // multiple claps in quick succession
      playClap(0.13); setTimeout(()=>playClap(0.12),80); setTimeout(()=>playClap(0.11),180);
    }, 1300);
  }
  function stopCrowd(){ if(crowdInterval) clearInterval(crowdInterval); crowdInterval=null; }

  function playBigClap(){
    // many claps
    for(let i=0;i<9;i++){ setTimeout(()=>playClap(0.15 + Math.random()*0.12), i*80); }
  }

  /* Public API */
  return {
    start: async function(){ await start(); startMelodyLoop(); startCrowd(); },
    setMuted: setMuted,
    playBigClap: playBigClap
  }
})();

/* Make sure mute button updates */
AudioEngine.setMuted = AudioEngine.setMuted || (v => {}); // fallback

/* Autoplay can't run until user interacts ‚Äî handled by start button. */

/* Small: Display "from" name editable via URL param ?from=YourName */
(function setFromNameFromUrl(){
  const params = new URLSearchParams(location.search);
  const f = params.get('from'); if(f){
    document.getElementById('fromName').textContent = decodeURIComponent(f);
  }
})();

/* Save answers (could be used to personalize final message) */
function collectAnswers(){
  return {
    q1: document.getElementById('a1')?.value || '',
    q2: document.getElementById('a2')?.value || '',
    q3: document.getElementById('a3')?.value || '',
    q4: document.getElementById('a4')?.value || '',
    q5: document.getElementById('a5')?.value || '',
    q6: document.getElementById('a6')?.value || '',
    q7: document.getElementById('a7')?.value || ''
  };
}

/* Optional: after page8 shown, you can show some dynamic personalization */
document.addEventListener('visibilitychange', ()=>{ /* placeholder */ });

/* initialize */
show(0);

/* Small UX: allow Enter to go next on text fields */
['a1','a2','a3','a4','a6'].forEach((id, idx)=>{
  const el = document.getElementById(id);
  if(!el) return;
  el.addEventListener('keyup', (e)=>{
    if(e.key === 'Enter'){ nextPage(idx+2) }
  });
});

/* Ensure a bunch of claps at final page entrance */
const origNextPage = nextPage;
nextPage = function(i){
  origNextPage(i);
  if(i === 8){
    // play an extra crowd cheer build up
    setTimeout(()=>AudioEngine.playBigClap(), 600);
  }
};
</script>
</body>
</html>